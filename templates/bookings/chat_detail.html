{% extends 'base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="glass flex flex-col h-[80vh] rounded-[3rem] overflow-hidden shadow-2xl animate-fade-in border-white/5 relative">
        <!-- Decoration side bar -->
        <div class="absolute top-0 right-0 w-1 h-full bg-brand-600/50"></div>

        <!-- Header -->
        <div class="p-8 bg-slate-900/80 border-b border-white/5 flex items-center justify-between backdrop-blur-xl z-20">
            <div class="flex items-center gap-6">
                <a href="{% url 'chat_list' %}" class="w-12 h-12 rounded-2xl bg-slate-800 flex items-center justify-center text-slate-400 hover:text-white hover:bg-slate-700 transition-all border border-white/5 group">
                    <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition-transform"></i>
                </a>
                <div>
                    <div class="flex items-center gap-3 mb-1">
                        <h3 class="font-black text-2xl text-white tracking-tighter">{{ other_user.username }}</h3>
                        <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    </div>
                    <div class="brand-badge !py-0.5 !px-2 !text-[8px] !tracking-widest uppercase">
                        {{ other_user.is_provider|yesno:"Heritage Provider,Enthusiastic Learner" }}
                    </div>
                </div>
            </div>
            <div class="flex gap-2">
                <button class="w-10 h-10 rounded-xl bg-slate-800/50 flex items-center justify-center text-slate-500 hover:text-brand-500 transition-colors border border-white/5">
                    <i class="fa-solid fa-phone-slash"></i>
                </button>
                <button class="w-10 h-10 rounded-xl bg-slate-800/50 flex items-center justify-center text-slate-500 hover:text-brand-500 transition-colors border border-white/5">
                    <i class="fa-solid fa-ellipsis-vertical"></i>
                </button>
            </div>
        </div>
        
        <!-- Messages -->
        <div id="message-container" class="flex-grow overflow-y-auto p-10 space-y-8 bg-[#0a0f1d]/50 scroll-smooth custom-scrollbar">
            {% for message in messages %}
                <div class="flex flex-col {% if message.sender == user %}items-end{% else %}items-start{% endif %} group">
                    <div class="max-w-[80%] relative">
                        <div class="chat-bubble {% if message.sender == user %}!bg-brand-600 !text-white !rounded-tr-none shadow-brand-600/20{% else %}!bg-slate-800 !text-slate-200 !rounded-tl-none border border-white/5 shadow-xl{% endif %} !rounded-3xl p-5 shadow-2xl transition-transform group-hover:scale-[1.02]">
                            <p class="text-[15px] font-medium leading-relaxed">{{ message.content }}</p>
                        </div>
                        <div class="flex items-center gap-2 mt-2 px-1 {% if message.sender == user %}flex-row-reverse{% endif %}">
                            <span class="text-[9px] font-black text-slate-600 uppercase tracking-widest">{{ message.timestamp|date:"g:i A" }}</span>
                            {% if message.sender == user %}
                                <i class="fa-solid fa-check-double text-brand-500 text-[10px]"></i>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% empty %}
                <div class="h-full flex flex-col items-center justify-center opacity-40">
                    <div class="w-20 h-20 bg-slate-900 rounded-[2rem] flex items-center justify-center text-3xl text-slate-700 mb-6 shadow-inner border border-white/5">
                        <i class="fa-solid fa-wand-magic-sparkles"></i>
                    </div>
                    <p class="text-slate-500 font-bold uppercase tracking-[0.2em] text-xs">Genesis of a new connection</p>
                </div>
            {% endfor %}
        </div>

        <!-- Input Area -->
        <div class="p-8 bg-slate-900/80 border-t border-white/5 backdrop-blur-xl z-20">
            <form method="post" class="flex gap-4 p-2 bg-slate-950 rounded-[2.2rem] border border-white/10 shadow-2xl focus-within:border-brand-600/50 transition-all duration-500">
                {% csrf_token %}
                <button type="button" class="w-14 h-14 rounded-full flex items-center justify-center text-slate-500 hover:text-white transition-colors">
                    <i class="fa-solid fa-plus text-xl"></i>
                </button>
                <input type="text" name="content" class="flex-grow bg-transparent border-none rounded-2xl px-4 py-4 text-white placeholder-slate-700 outline-none font-bold text-lg" placeholder="Whisper your message..." required autocomplete="off">
                <button type="submit" class="bg-brand-600 text-white w-14 h-14 rounded-[1.5rem] flex items-center justify-center text-xl hover:bg-brand-500 hover:scale-105 transition-all shadow-xl shadow-brand-600/20 group active:scale-95">
                    <i class="fa-solid fa-paper-plane group-hover:rotate-12 transition-transform"></i>
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    const container = document.getElementById('message-container');
    container.scrollTop = container.scrollHeight;
</script>
{% endblock %}
